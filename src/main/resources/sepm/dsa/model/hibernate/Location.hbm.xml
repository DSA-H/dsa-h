<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping>

    <query name="Location.findAll">
        <![CDATA[from Location ORDER BY name ASC]]>
    </query>

    <query name="Location.findAllAround">
        <![CDATA[   FROM Location
                    WHERE (:ownLocationId is NULL OR id != :ownLocationId) AND sqrt((:xCoord - xCoord) * (:xCoord - xCoord) + (:yCoord - yCoord) * (:yCoord - yCoord)) < :distance
                    ORDER BY name ASC]]>
    </query>

    <query name="Location.findAllAroundNotConnected">
        <![CDATA[   FROM Location l
                    WHERE (:ownLocationId is NULL OR l.id != :ownLocationId) AND sqrt((:xCoord - l.xCoord) * (:xCoord - l.xCoord) + (:yCoord - l.yCoord) * (:yCoord - l.yCoord)) < :distance
                            AND l.id NOT IN (select c.pk.location2.id from LocationConnection c where c.pk.location1.id = :ownLocationId)
                            AND l.id NOT IN (select c.pk.location1.id from LocationConnection c where c.pk.location2.id = :ownLocationId)
                    ORDER BY l.name ASC]]>
    </query>

</hibernate-mapping>
